import { useEffect, useRef, useState } from 'react'
import Head from 'next/head'
import Image from 'next/image'
import { Inter } from '@next/font/google'
import Layout from '@components/Layout'
import CardMotion from '@components/CardMotion'
import FloatingActionButton from '@components/FloatingActionButton'
import EmailLogin from '@components/SignIn/EmailLogin'
import { useRecoilValue } from 'recoil'
import { sidebarState } from 'src/state/sidebarState'
import Sidebar from '@components/Sidebar'
import { AnimatePresence } from 'framer-motion'
import { onAuthStateChanged } from 'firebase/auth'
import { auth } from 'src/config/firebaseConfig'

const inter = Inter({ subsets: ['latin'] })

export default function Home() {
  const sidebarOpen = useRecoilValue(sidebarState)
  const boardRef = useRef<HTMLDivElement>(null)
  const containerX = useRef(0)
  const containerY = useRef(0)

  onAuthStateChanged(auth, (user) => {
    if (user) {
      // User is signed in, see docs for a list of available properties
      // https://firebase.google.com/docs/reference/js/firebase.User
      console.log(user)
      // ...
    } else {
      console.log('로그인 NO')
    }
  })

  useEffect(() => {
    if (boardRef.current !== null) {
      const { width, height } = boardRef.current.getBoundingClientRect()
      console.log('컨테이너 너비와 높이: ', width, height)
    }
  }, [])

  return (
    <Layout>
      <Head>
        <title>천국열쇠 챌린지</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <Image
        src={'/images/tree.png'}
        alt=""
        width={1501}
        height={1500}
        style={{
          position: 'absolute',
          top: '50%',
          left: 0,
          transform: 'translateY(-50%)',
        }}
        priority={true}
      />
      <AnimatePresence>{sidebarOpen && <Sidebar />}</AnimatePresence>

      <div className="w-full h-[calc(100%-80px)] py-8 px-4 bg-teal-50">
        <h1 className="text-center font-gamjaFlower text-2xl">
          현재 1,215개 천국열쇠가 생성되었습니다
        </h1>
        <p className="text-center mt-8">
          로그인하면 예언적선포문을 작성할 수 있습니다
        </p>
        <button>로그인하기</button>
        <EmailLogin />
        <div className="w-full h-full" ref={boardRef}></div>
        <FloatingActionButton />
      </div>
    </Layout>
  )
}
